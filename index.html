<script>
    // --- –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ window.Telegram. –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã—à–∫—É.
    const tg = window.Telegram ? window.Telegram.WebApp : {
        initDataUnsafe: { user: { id: 12345 } }, // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
        expand: () => console.log("expand called"),
        ready: () => console.log("ready called")
    };
    tg.ready();
    tg.expand();

    // üõë –í–ê–ñ–ù–û: –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å—Å—ã–ª–∫—É –∏–∑ Ngrok!
    const API_URL = "https://salubriously-ophthalmic-eveline.ngrok-free.dev"; 
    
    // –ü–æ–ª—É—á–∞–µ–º ID —é–∑–µ—Ä–∞. –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –≤–æ–∑—å–º—É—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.
    const myId = tg.initDataUnsafe.user.id;

    // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ ---
    function showError(title, message) {
        document.body.innerHTML = `
            <div style="padding: 20px; text-align: center; color: #ff7675; font-family: sans-serif;">
                <h1>${title}</h1>
                <p>${message}</p>
            </div>
        `;
    }

    // --- –û–°–ù–û–í–ù–û–ô –ö–û–î, –ö–û–¢–û–†–´–ô –¢–ï–ü–ï–†–¨ –ó–ê–ü–£–°–¢–ò–¢–°–Ø ---
    async function loadData() {
        try {
            let response = await fetch(`${API_URL}/api/get_user/${myId}`, {
                headers: { 'ngrok-skip-browser-warning': 'true' }
            });

            if (!response.ok) {
                throw new Error(`–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª —Å –æ—à–∏–±–∫–æ–π: ${response.status}`);
            }

            let data = await response.json();

            if (data.error) {
                showError("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö!", "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ /start –≤ –±–æ—Ç–µ, —á—Ç–æ–±—ã –æ–Ω —Å–æ–∑–¥–∞–ª —Ç–≤–æ–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞.");
                return;
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å HTML-–∫–æ–¥ –∏–≥—Ä—ã.
            // –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ–¥–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ.
            document.body.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #00cec9; font-family: sans-serif;">
                    <h1>‚úÖ –°–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º –£–°–¢–ê–ù–û–í–õ–ï–ù–ê!</h1>
                    <p>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã: ${JSON.stringify(data)}</p>
                    <p>–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª HTML-–∫–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã.</p>
                </div>
            `;

        } catch (e) {
            console.error(e);
            showError("–ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É!", `–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Python –∏ Ngrok –∑–∞–ø—É—â–µ–Ω—ã. –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${e.message}`);
        }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadData();
</script>
