<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tamagotchi Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121212;
            --glass: rgba(255, 255, 255, 0.1);
            --accent: #6c5ce7;
            --danger: #ff7675;
            --success: #00cec9;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #2d3436, #000000);
            color: white;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (–£—Ä–æ–≤–µ–Ω—å –∏ –î–µ–Ω—å) --- */
        .top-bar {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            background: var(--glass);
            backdrop-filter: blur(10px);
        }
        .level-box { font-weight: bold; color: var(--success); }

        /* --- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù --- */
        .main-screen {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-y: auto;
        }

        /* --- –ü–ò–¢–û–ú–ï–¶ –ò –î–ò–ê–õ–û–ì–ò --- */
        .pet-container { position: relative; margin-bottom: 20px; }
        .pet { font-size: 100px; transition: transform 0.3s; cursor: pointer; }
        .speech-bubble {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: black;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -5px; left: 50%;
            border-width: 5px; border-style: solid;
            border-color: white transparent transparent transparent;
        }
        .show-bubble { opacity: 1; top: -70px; }

        /* --- –°–¢–ê–¢–ò–°–¢–ò–ö–ê --- */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 90%;
            background: var(--glass);
            padding: 15px;
            border-radius: 20px;
        }
        .stat-item { text-align: left; }
        .stat-label { font-size: 12px; opacity: 0.7; }
        .progress-bar {
            height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 3px; margin-top: 5px; overflow: hidden;
        }
        .fill { height: 100%; transition: width 0.5s; }

        /* --- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô --- */
        .actions-bar {
            display: flex; gap: 10px; margin-top: 20px;
        }
        .action-btn {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 15px; border-radius: 12px;
            font-size: 20px; cursor: pointer;
        }
        .action-btn:active { transform: scale(0.95); background: var(--accent); }

        /* --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (–¢–ê–ë–´) --- */
        .bottom-nav {
            display: flex; justify-content: space-around;
            background: #1e1e1e; padding: 15px 0;
            border-top: 1px solid #333;
        }
        .nav-item {
            font-size: 24px; opacity: 0.5; cursor: pointer;
            display: flex; flex-direction: column; align-items: center;
        }
        .nav-item.active { opacity: 1; color: var(--accent); }
        .nav-text { font-size: 10px; margin-top: 4px; }

        /* --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (–í–∫–ª–∞–¥–∫–∏) --- */
        .tab-content {
            display: none; width: 100%; height: 100%;
            flex-direction: column; align-items: center; padding-top: 20px;
        }
        .tab-content.active { display: flex; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏ –°–∫–∏–ª–ª–æ–≤ */
        .grid-box {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 90%;
        }
        .item-card {
            background: var(--glass); padding: 10px; border-radius: 10px;
            text-align: center; font-size: 12px; border: 1px solid #333;
        }
        .skill-tree {
            display: flex; flex-direction: column; gap: 10px; width: 90%;
        }
        .skill-node {
            background: var(--glass); padding: 15px; border-radius: 12px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .locked { filter: grayscale(1); opacity: 0.5; }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box {
            background: #2d3436; padding: 20px; border-radius: 20px;
            text-align: center; max-width: 80%; border: 1px solid var(--accent);
        }
    </style>
</head>
<body>

    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
    <div class="top-bar">
        <div class="level-box">LVL <span id="lvl">1</span></div>
        <div id="coins">ü™ô 100</div>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢: –ì–õ–ê–í–ù–ê–Ø (Home) -->
    <div id="tab-home" class="main-screen tab-content active">
        <div class="pet-container">
            <div id="bubble" class="speech-bubble">–ü—Ä–∏–≤–µ—Ç!</div>
            <div id="pet" class="pet" onclick="petClick()">ü•ö</div>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</div>
                <div class="progress-bar"><div id="bar-hp" class="fill" style="background:#ff7675; width:100%"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">üçî –ì–æ–ª–æ–¥</div>
                <div class="progress-bar"><div id="bar-food" class="fill" style="background:#ffeaa7; width:100%"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">üòÑ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                <div class="progress-bar"><div id="bar-mood" class="fill" style="background:#74b9ff; width:100%"></div></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
                <div class="progress-bar"><div id="bar-energy" class="fill" style="background:#55efc4; width:100%"></div></div>
            </div>
        </div>

        <div class="actions-bar">
            <button class="action-btn" onclick="doAction('feed')">üçî</button>
            <button class="action-btn" onclick="doAction('walk')">üå≥</button>
            <button class="action-btn" onclick="doAction('heal')">üíä</button>
            <button class="action-btn" onclick="doAction('clean')">üßΩ</button>
        </div>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢: –ù–ê–í–´–ö–ò (Skills) -->
    <div id="tab-skills" class="main-screen tab-content">
        <h2>–î–µ—Ä–µ–≤–æ –Ω–∞–≤—ã–∫–æ–≤ üå≥</h2>
        <div class="skill-tree">
            <div class="skill-node" onclick="unlockSkill('speak')">
                <div>üó£Ô∏è <b>–ì–æ–≤–æ—Ä—É–Ω</b><br><small>–ü–∏—Ç–æ–º–µ—Ü –±–æ–ª—Ç–∞–µ—Ç —á–∞—â–µ</small></div>
                <div id="skill-speak">üîí 500ü™ô</div>
            </div>
            <div class="skill-node locked" id="node-hunt">
                <div>imÔ∏è <b>–û—Ö–æ—Ç–Ω–∏–∫</b><br><small>–î–æ–±—ã—á–∞ –º–æ–Ω–µ—Ç –Ω–∞ –ø—Ä–æ–≥—É–ª–∫–µ</small></div>
                <div>üîí LVL 5</div>
            </div>
        </div>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢: –ò–ù–í–ï–ù–¢–ê–†–¨ (Box) -->
    <div id="tab-box" class="main-screen tab-content">
        <h2>–®–∫–∞—Ç—É–ª–∫–∞ üì¶</h2>
        <div class="grid-box">
            <div class="item-card">üíä<br>–ê–ø—Ç–µ—á–∫–∞<br><b>x<span id="inv-med">2</span></b></div>
            <div class="item-card">üß∏<br>–ú–∏—à–∫–∞<br><b>x<span id="inv-toy">1</span></b></div>
            <div class="item-card">üéüÔ∏è<br>–ë–∏–ª–µ—Ç<br><b>x0</b></div>
        </div>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢: –ü–ê–ú–Ø–¢–¨ (Memory) -->
    <div id="tab-mem" class="main-screen tab-content">
        <h2>–ê–ª—å–±–æ–º üì∏</h2>
        <div style="padding: 20px; text-align: center; opacity: 0.6;">
            –ó–¥–µ—Å—å –±—É–¥—É—Ç —Ñ–æ—Ç–æ —Å –ø—Ä–æ–≥—É–ª–æ–∫...<br>(–ü–æ–∫–∞ –ø—É—Å—Ç–æ)
        </div>
    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">üè†<span class="nav-text">–î–æ–º</span></div>
        <div class="nav-item" onclick="switchTab('skills', this)">üéì<span class="nav-text">–ù–∞–≤—ã–∫–∏</span></div>
        <div class="nav-item" onclick="switchTab('box', this)">üéí<span class="nav-text">–®–∫–∞—Ç—É–ª–∫–∞</span></div>
        <div class="nav-item" onclick="switchTab('mem', this)">üì∏<span class="nav-text">–ü–∞–º—è—Ç—å</span></div>
    </div>

    <!-- POPUP MODAL -->
    <div id="modal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3 id="modal-title">–°–æ–±—ã—Ç–∏–µ!</h3>
            <p id="modal-text">–¢–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è</p>
            <button class="action-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï (State)
        let game = {
            lvl: 1,
            xp: 0,
            coins: 100,
            stats: { hp: 100, food: 80, mood: 80, energy: 80 },
            inventory: { medkit: 2, toy: 1 },
            skills: { speak: false },
            petType: 'baby', // baby, teen, adult
            lastLogin: Date.now()
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        if (localStorage.getItem('tamaSave')) {
            game = JSON.parse(localStorage.getItem('tamaSave'));
            checkDailyReport(); // –ü—Ä–æ–≤–µ—Ä–∫–∞ "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"
        }

        // 2. –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê
        function updateUI() {
            // –°—Ç–∞—Ç—ã
            document.getElementById('bar-hp').style.width = game.stats.hp + '%';
            document.getElementById('bar-food').style.width = game.stats.food + '%';
            document.getElementById('bar-mood').style.width = game.stats.mood + '%';
            document.getElementById('bar-energy').style.width = game.stats.energy + '%';
            
            // –ò–Ω—Ñ–æ
            document.getElementById('lvl').innerText = game.lvl;
            document.getElementById('coins').innerText = 'ü™ô ' + game.coins;
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            document.getElementById('inv-med').innerText = game.inventory.medkit;
            document.getElementById('inv-toy').innerText = game.inventory.toy;

            // –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –ø–∏—Ç–æ–º—Ü–∞
            const petEl = document.getElementById('pet');
            if (game.stats.hp < 30) petEl.innerText = 'ü§í'; // –ë–æ–ª–µ–µ—Ç
            else if (game.stats.food < 20) petEl.innerText = 'üòµ'; // –ì–æ–ª–æ–¥–µ–Ω
            else if (game.lvl >= 5) petEl.innerText = 'ü¶ñ'; // –í–∑—Ä–æ—Å–ª—ã–π
            else petEl.innerText = 'üê£'; // –ú–∞–ª—ã—à
        }

        function doAction(type) {
            tg.HapticFeedback.impactOccurred('medium');

            if (game.stats.hp < 30 && type !== 'heal') {
                say("–Ø –±–æ–ª–µ—é... –î–∞–π –ª–µ–∫–∞—Ä—Å—Ç–≤–æ üíä");
                return;
            }

            if (type === 'feed') {
                if (game.coins < 10) return say("–ù–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –µ–¥—É! üí∏");
                game.coins -= 10;
                game.stats.food = Math.min(100, game.stats.food + 30);
                game.stats.energy = Math.min(100, game.stats.energy + 5);
                say("–í–∫—É—Å–Ω–æ! üçó");
            } 
            else if (type === 'walk') {
                if (game.stats.energy < 20) return say("–Ø —É—Å—Ç–∞–ª... üí§");
                game.stats.energy -= 20;
                game.stats.mood = Math.min(100, game.stats.mood + 20);
                game.xp += 10;
                handleRandomEvent(); // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
            }
            else if (type === 'heal') {
                if (game.inventory.medkit > 0) {
                    game.inventory.medkit--;
                    game.stats.hp = 100;
                    say("–°–ø–∞—Å–∏–±–æ, –¥–æ–∫—Ç–æ—Ä! üíñ");
                } else {
                    say("–ù–µ—Ç –∞–ø—Ç–µ—á–µ–∫! –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ (—Å–∫–æ—Ä–æ)");
                }
            }
            else if (type === 'clean') {
                say("–¢–µ–ø–µ—Ä—å —á–∏—Å—Ç–æ! ‚ú®");
                game.stats.mood += 5;
            }

            checkLevelUp();
            saveGame();
            updateUI();
        }

        // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –ø—Ä–æ–≥—É–ª–∫–µ (–ö–≤–µ—Å—Ç—ã)
        function handleRandomEvent() {
            const roll = Math.random();
            if (roll > 0.7) {
                const foundCoins = Math.floor(Math.random() * 50) + 10;
                game.coins += foundCoins;
                showModal("–ù–∞—Ö–æ–¥–∫–∞! üíé", `–¢—ã –≥—É–ª—è–ª –∏ –Ω–∞—à–µ–ª ${foundCoins} –º–æ–Ω–µ—Ç!`);
            } else if (roll < 0.2) {
                game.stats.hp -= 10;
                showModal("–û–π! üåµ", "–¢—ã —Å–ø–æ—Ç–∫–Ω—É–ª—Å—è –∏ —É—à–∏–± –ª–∞–ø–∫—É. –ó–¥–æ—Ä–æ–≤—å–µ -10");
            } else {
                say("–•–æ—Ä–æ—à–∞—è –ø—Ä–æ–≥—É–ª–∫–∞... üçÉ");
            }
        }

        // –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π
        function checkLevelUp() {
            if (game.xp > game.lvl * 100) {
                game.lvl++;
                game.xp = 0;
                showModal("–£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù! üéâ", `–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π –ø–∏—Ç–æ–º–µ—Ü ${game.lvl} —É—Ä–æ–≤–Ω—è!`);
                tg.HapticFeedback.notificationOccurred('success');
            }
        }

        // –û–±–ª–∞—á–∫–æ —Å —Ç–µ–∫—Å—Ç–æ–º
        function say(text) {
            const bubble = document.getElementById('bubble');
            bubble.innerText = text;
            bubble.classList.add('show-bubble');
            setTimeout(() => bubble.classList.remove('show-bubble'), 3000);
        }

        function petClick() {
            say(game.stats.mood > 50 ? "–ú—É—Ä-–º—É—Ä! ‚ù§Ô∏è" : "–ù–µ —Ç—Ä–æ–≥–∞–π –º–µ–Ω—è üí¢");
            tg.HapticFeedback.selectionChanged();
        }

        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç (—Å–∏–º—É–ª—è—Ü–∏—è)
        function checkDailyReport() {
            const now = Date.now();
            const hoursPassed = (now - game.lastLogin) / (1000 * 60 * 60);
            
            if (hoursPassed > 12) {
                game.stats.food = Math.max(0, game.stats.food - 50);
                game.stats.mood = Math.max(0, game.stats.mood - 30);
                showModal("–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç üìÖ", "–ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ, –ø–∏—Ç–æ–º–µ—Ü —Å–∏–ª—å–Ω–æ –ø—Ä–æ–≥–æ–ª–æ–¥–∞–ª—Å—è –∏ –∑–∞—Å–∫—É—á–∞–ª.");
            }
            game.lastLogin = now;
            saveGame();
        }

        // --- –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò ---
        function switchTab(tabId, element) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π
            document.getElementById('tab-' + tabId).classList.add('active');
            element.classList.add('active');
            tg.HapticFeedback.selectionChanged();
        }

        function saveGame() {
            localStorage.setItem('tamaSave', JSON.stringify(game));
        }

        function showModal(title, text) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // –¢–∞–π–º–µ—Ä: —Å—Ç–∞—Ç—ã –ø–∞–¥–∞—é—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
        setInterval(() => {
            if(game.stats.food > 0) game.stats.food -= 1;
            if(game.stats.energy < 100) game.stats.energy += 0.5; // –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–∞–º–∞ –º–µ–¥–ª–µ–Ω–Ω–æ
            updateUI();
            saveGame();
        }, 5000); // –†–∞–∑ –≤ 5 —Å–µ–∫—É–Ω–¥

        updateUI(); // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    </script>
</body>
</html>
